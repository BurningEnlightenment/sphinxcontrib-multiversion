language: python
python:
- 3.6
- 3.7
cache:
  pip: true

install:
- python -m pip install pre-commit setuptools wheel
- python -m pip install -r requirements.txt
- python setup.py install

before_script:
- pre-commit run --all-files
script:
- mkdir html
- sphinx-multiversion -W docs html
- python setup.py build sdist bdist_wheel

# Deployment
before_deploy:
  - touch html/.nojekyll
  - cp assets/gh-pages-redirect.html html/index.html
deploy:
  # Deploy documentation
- provider: pages
  skip_cleanup: true
  keep_history: false
  github_token: $GITHUB_TOKEN
  local_dir: html
  on:
    branch: master
    repo: Holzhaus/sphinx-multiversion
